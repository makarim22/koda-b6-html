<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="detail-order.css">
    <title>Order Details</title>
</head>

<body>
    <header class="container">
        <div class="logo">
            <div>
                <img src="./src/icons/home/Frame.svg" alt="Menu" />
                <img src="./src/icons/home/Logo.svg" alt="Logo" />
            </div>
            <div>
                <nav class="left-header">
                    <a href="home.html">Home</a>
                    <a href="product.html">Product</a>
                </nav>
            </div>
        </div>
        <div class="search-container">
            <nav class="right-header">
                <img src="./src/icons/Search.svg" alt="Search" />
                <img src="./src/icons/ShoppingCart.svg" alt="Cart" />
                <a class="login-button" href="login.html">Sign In</a>
                <a class="register-button" href="register.html">Sign Up</a>
            </nav>
        </div>
    </header>

    <main>
        <h1 class="page-title">Order #12354-09893</h1>
        <p class="page-date">21 March 2023 at 10:30 AM</p>

        <div class="container-content">
            <!-- <section class="order-info">
                <h2>Order Information</h2>
                <div class="info-item">
                    <span class="info-label">Full Name</span>
                    <span class="info-value">Ghaluh Wizard Anggoro</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Address</span>
                    <span class="info-value">Griya Bandung Indah</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Phone</span>
                    <span class="info-value">082116304338</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Payment Method</span>
                    <span class="info-value">Cash</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Shipping</span>
                    <span class="info-value">Dine In</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status</span>
                    <span class="status">Done</span>
                </div>
                <div class="total-section">
                    <span class="total-label">Total Transaction</span>
                    <span class="total-amount">IDR 40.000</span>
                </div>
            </section> -->

            <section class="order-summary">
                <h2>Your Order</h2>
                <div class="order-item">
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section about">
                <img src="./src/icons/coffee-cup.svg">
                <img src="./src/icons/coffee-shop.svg">
                <p style="margin-top: 20px;">
                    Coffee Shop is a store that sells some good meals, and especially
                    coffee. We provide high quality beans.
                </p>
                <p>&copy; 2020 CoffeeStore</p>
            </div>
            <div class="footer-section products">
                <h3>Product</h3>
                <ul>
                    <li>Our Product</li>
                    <li>Pricing</li>
                    <li>Locations</li>
                    <li>Countries</li>
                    <li>Blog</li>
                </ul>
            </div>
            <div class="footer-section engage">
                <h3>Engage</h3>
                <ul>
                    <li>Partner</li>
                    <li>FAQ</li>
                    <li>About Us</li>
                    <li>Privacy Policy</li>
                    <li>Terms of Service</li>
                </ul>
            </div>
            <div class="footer-section social-media">
                <h3>Social Media</h3>
                <div class="social-icons">
                    <img src="./src/icons/Facebook.svg" alt="Facebook" />
                    <img src="./src/icons/Twitter.svg" alt="Twitter" />
                    <img src="./src/icons/Instagram.png" alt="Instagram" />
                </div>
            </div>
        </div>
    </footer>

    <script>
        const ordersString = localStorage.getItem("order");

        let orders = [];

        if (ordersString) {
            try {
                orders = JSON.parse(ordersString);
            } catch (e) {
                console.error("Error parsing orders from localStorage:", e);
            }
        }

        const userString = localStorage.getItem("user-data");
        const user = JSON.parse(userString);
        const LoggedInUser = user.find((user) => user.isLoggedIn === true);
        console.log('Logged In User', LoggedInUser);


        const relevantOrder = orders[orders.length - 1];
        console.log('relevant order', relevantOrder);

        relevantOrder.customer = LoggedInUser.name;
        relevantOrder.customerEmail = LoggedInUser.email;
        relevantOrder.customerPhone = LoggedInUser.phone;
        relevantOrder.customerAddress = LoggedInUser.address;

        if (relevantOrder) {

            const orderSection = document.createElement("section");
            orderSection.className = "order-info";

            const heading = document.createElement("h2");
            heading.textContent = "Order Information";
            orderSection.appendChild(heading);

            const createInfoItem = (label, value) => {
                const infoItem = document.createElement("div");
                infoItem.className = "info-item";

                const labelSpan = document.createElement("span");
                labelSpan.className = "info-label";
                labelSpan.textContent = label;

                const valueSpan = document.createElement("span");
                valueSpan.className = "info-value";
                valueSpan.textContent = value;

                infoItem.appendChild(labelSpan);
                infoItem.appendChild(valueSpan);
                return infoItem;
            };

            orderSection.appendChild(createInfoItem("Full Name", relevantOrder.customer));
            orderSection.appendChild(createInfoItem("Address", relevantOrder.customerAddress));
            orderSection.appendChild(createInfoItem("Phone", relevantOrder.customerPhone));
            orderSection.appendChild(createInfoItem("Payment Method", relevantOrder.payment));
            orderSection.appendChild(createInfoItem("Shipping", relevantOrder.orderType));

            const statusItem = document.createElement("div");
            statusItem.className = "info-item";
            const statusLabel = document.createElement("span");
            statusLabel.className = "info-label";
            statusLabel.textContent = "Status";
            const statusValue = document.createElement("span");
            statusValue.className = "status";
            statusValue.textContent = relevantOrder.status;
            statusItem.appendChild(statusLabel);
            statusItem.appendChild(statusValue);
            orderSection.appendChild(statusItem);

            const totalSection = document.createElement("div");
            totalSection.className = "total-section";

            const totalLabel = document.createElement("span");
            totalLabel.className = "total-label";
            totalLabel.textContent = "Total Transaction";

            const totalAmount = document.createElement("span");
            totalAmount.className = "total-amount";
            totalAmount.textContent = `IDR ${relevantOrder.total.toLocaleString('id-ID')}`;

            totalSection.appendChild(totalLabel);
            totalSection.appendChild(totalAmount);
            orderSection.appendChild(totalSection);

            const container = document.querySelector(".container-content");
            container.appendChild(orderSection);


            ///
            const orderItems = document.querySelector(".order-item");

            const img = document.createElement("img");
            img.src = "/src/product/product2.png";
            img.alt = "Hazelnut Latte";
            img.className = "item-image";

            const itemDetails = document.createElement("div");
            itemDetails.className = "item-details";

            const badge = document.createElement("span");
            badge.className = "item-badge";
            badge.textContent = "FLASH SALE";

            const name = document.createElement("h3");
            name.textContent = "Hazelnut Latte";

            const price = document.createElement("p");
            price.textContent = `IDR ${relevantOrder.total.toLocaleString('id-ID')}`;

            const specs = document.createElement("p");
            specs.textContent = `${relevantOrder.quantity}pcs | ${relevantOrder.size} | ${relevantOrder.orderType.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}`;

            const priceSection = document.createElement("div");
            priceSection.className = "item-price-section";

            const originalPrice = document.createElement("span");
            originalPrice.className = "item-original-price";
            originalPrice.textContent = `IDR ${relevantOrder.total.toLocaleString('id-ID')}`;

            const discount = document.createElement("span");
            discount.className = "item-discount";
            discount.textContent = `IDR ${relevantOrder.price.toLocaleString('id-ID')}`;

            priceSection.appendChild(originalPrice);
            priceSection.appendChild(discount);

            itemDetails.appendChild(badge);
            itemDetails.appendChild(name);
            itemDetails.appendChild(specs);
            itemDetails.appendChild(priceSection);

            orderItems.appendChild(img);
            orderItems.appendChild(itemDetails);

        }

        ///
        const header = document.querySelector(".right-header");

        let creds = localStorage.getItem("user-data");
        console.log('credsnya', creds);

        if (creds) {
            credsNew = JSON.parse(creds);
            let user = credsNew.find((user) => user.isLoggedIn === true);
            console.log('creds', creds);
            console.log('user', user);


            const signIn = document.querySelector(".login-button");
            signIn.textContent = `Hi, ${user.name}`;
            signIn.href = "#";

            const signOut = document.querySelector(".register-button");
            signOut.textContent = "Logout";

            signOut.addEventListener("click", () => {
                user.isLoggedIn = false;
                localStorage.setItem("user-data", JSON.stringify(creds));
                signOut.href = "login.html";
            })

        }


    </script>
</body>

</html>